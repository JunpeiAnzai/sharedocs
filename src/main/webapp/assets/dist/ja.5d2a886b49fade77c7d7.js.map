{"version":3,"sources":["webpack:///ja.5d2a886b49fade77c7d7.js","webpack:///webpack/bootstrap 5d2a886b49fade77c7d7?f459","webpack:///./src/main/webapp/WEB-INF/assets/ja.js","webpack:///./src/main/webapp/assets/js/notification.js?3734","webpack:///./src/main/webapp/assets/js/notification.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","global","this","notification","createMessageParts","data","msg","article","article_id","fragment_id","image","sender","title","type","type1","action","is_commenter","target","when","getRelativeTime","state","targetDateStr","baseDate","Date","targetDate","elapsedTime","Math","ceil","getTime","message","floor","csrfToken","$","attr","ajax","method","url","dataType","csrf-token","done","json","text","count","length","children","remove","html","i","append","replace","favicon","Favico","animation","addClass","on","removeClass","reset","badge","document","css","e","stopPropagation","toggle","fail","xhr","status","error","console","log"],"mappings":"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","file":"ja.5d2a886b49fade77c7d7.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/assets/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(3);\n\n/***/ },\n/* 1 */,\n/* 2 */,\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(global) {module.exports = global[\"notification\"] = __webpack_require__(4);\n\t/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tvar notification = function(){\n\t  var csrfToken = $('meta[name=csrf-token]').attr(\"content\");\n\t  $.ajax({\n\t    method: 'GET',\n\t    url: '/notifications',\n\t    dataType: 'json',\n\t    data: {'csrf-token': csrfToken}\n\t  }).done(function(json){\n\t    $('#notification_count').text(json.count);\n\t    if(json.data.length>0){\n\t      $('#notification-items').children().remove();\n\t      $('#notification-default').remove();\n\t      var html = '\\\n\t      <li class=\"notification-contents-list-item\"> \\\n\t      <a href=\"/articles/___article___\" class=\"notification-contents-item-link___state___\"> \\\n\t        <div class=\"notification-contents-item-icon\"> \\\n\t          <img src=\"___image___\" /> \\\n\t        </div> \\\n\t        <div class=\"notification-contents-item-text\"> \\\n\t          <span class=\"sender\">___sender___</span>があなたの___target___<span class=\"title\">\"___title___\"</span>___type1___<span class=\"action ___type___\">___action___</span>しました。 \\\n\t          <div class=\"status\">___when___</div> \\\n\t        </div> \\\n\t      </a> \\\n\t      </li>';\n\t      for(var i=0; i < json.data.length; i++){\n\t        var data = createMessageParts(json.data[i]);\n\t        $('#notification-items').append($(html\n\t          .replace(/___article___/, data.article)\n\t          .replace(/___image___/, data.image)\n\t          .replace(/___sender___/, data.sender)\n\t          .replace(/___target___/, data.target)\n\t          .replace(/___title___/, data.title)\n\t          .replace(/___type___/, data.type)\n\t          .replace(/___type1___/, data.type1)\n\t          .replace(/___action___/, data.action)\n\t          .replace(/___when___/, data.when)\n\t          .replace(/___state___/, data.state)\n\t        ));\n\t      }\n\t    }\n\t    var favicon = new Favico({\n\t      animation:'none'\n\t    });\n\t    if (json.count != 0) {\n\t      $('#notification_count').addClass('unchecked').on('click', function(){\n\t        $.ajax({\n\t          method: 'POST',\n\t          url: '/notifications',\n\t          dataType: 'json',\n\t          data: {'csrf-token': csrfToken}\n\t        }).done(function(json){\n\t          $('#notification_count').removeClass('unchecked').text(json.count);\n\t          favicon.reset();\n\t        });\n\t      });\n\t      favicon.badge(json.count);\n\t    } else {\n\t      favicon.reset();\n\t    }\n\t    $(document).on('click', function(){$('.dropdownWrapper').css('display', 'none')});\n\t    $('#notification_count').on('click', function(e){e.stopPropagation();$('.dropdownWrapper').toggle()});\n\t  }).fail(function(xhr, status, error){\n\t    console.log(\"error during get notifications\");\n\t  });\n\t\n\t  function createMessageParts(data){\n\t    var msg = {};\n\t    msg.article = data.article_id + (data.fragment_id ? \"#comment-\" + data.fragment_id : \"\");\n\t    msg.image = data.image;\n\t    msg.sender = data.sender;\n\t    msg.title = data.title;\n\t    msg.type = data.type;\n\t    if (data.type == \"stock\") {\n\t      msg.type1 = \"を\";\n\t      msg.action = \"ストック\";\n\t    }else if (data.type == \"like\"){\n\t      msg.type1 = \"に\";\n\t      msg.action = \"いいね!\";\n\t    }else{\n\t      msg.type1 = \"で\";\n\t      msg.action = \"コメント\";\n\t    }\n\t    if (data.is_commenter){\n\t      msg.target = \"コメントした投稿\";\n\t    }else{\n\t      msg.target = \"投稿\";\n\t    }\n\t    msg.when = getRelativeTime(data.when);\n\t    if (data.state) {\n\t      msg.state = \"\";\n\t    }else{\n\t      msg.state = \"unread\";\n\t    }\n\t    return msg;\n\t  }\n\t\n\t  // http://qiita.com/rev84/items/2a14a804857de27e9c44\n\t  function getRelativeTime(targetDateStr){\n\t    var baseDate = new Date();\n\t    var targetDate = new Date(targetDateStr);\n\t    var elapsedTime = Math.ceil((baseDate.getTime() - targetDate.getTime())/1000);\n\t    var message = null;\n\t    if (elapsedTime < 60) { //  1 分未満\n\t      message =  'たった今';\n\t    } else if (elapsedTime < 120) { //  2 分未満\n\t      message =  '約 1分前';\n\t    } else if (elapsedTime < (60*60)) { //  1 時間未満\n\t      message =  '約' + (Math.floor(elapsedTime / 60) < 10 ? ' ' : '') + Math.floor(elapsedTime / 60) + '分前';\n\t    } else if (elapsedTime < (120*60)) { //  2 時間未満\n\t      message =  '約 1時間前';\n\t    } else if (elapsedTime < (24*60*60)) { //  1 日未満\n\t      message =  '約' + (Math.floor(elapsedTime / 3600) < 10 ? ' ' : '') + Math.floor(elapsedTime / 3600) + '時間前';\n\t    } else if (elapsedTime < (7*24*60*60)) { // 1 週間未満\n\t      message =  '約' + (Math.floor(elapsedTime / 86400) < 10 ? ' ' : '') +Math.floor(elapsedTime / 86400) + '日前';\n\t    } else { // 1 週間以上\n\t      message =  '約' + (Math.floor(elapsedTime / 604800) < 10 ? ' ' : '') + Math.floor(elapsedTime / 604800) + '週間前';\n\t    }\n\t    return message;\n\t  }\n\t};\n\tmodule.exports = notification;\n\t\n\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// ja.5d2a886b49fade77c7d7.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5d2a886b49fade77c7d7","require('expose?notification!../../assets/js/notification.js');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/main/webapp/WEB-INF/assets/ja.js\n// module id = 0\n// module chunks = 1","module.exports = global[\"notification\"] = require(\"-!/Users/ryu/Projects/sharedocs/src/main/webapp/assets/js/notification.js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/expose-loader?notification!./src/main/webapp/assets/js/notification.js\n// module id = 3\n// module chunks = 1","var notification = function(){\n  var csrfToken = $('meta[name=csrf-token]').attr(\"content\");\n  $.ajax({\n    method: 'GET',\n    url: '/notifications',\n    dataType: 'json',\n    data: {'csrf-token': csrfToken}\n  }).done(function(json){\n    $('#notification_count').text(json.count);\n    if(json.data.length>0){\n      $('#notification-items').children().remove();\n      $('#notification-default').remove();\n      var html = '\\\n      <li class=\"notification-contents-list-item\"> \\\n      <a href=\"/articles/___article___\" class=\"notification-contents-item-link___state___\"> \\\n        <div class=\"notification-contents-item-icon\"> \\\n          <img src=\"___image___\" /> \\\n        </div> \\\n        <div class=\"notification-contents-item-text\"> \\\n          <span class=\"sender\">___sender___</span>があなたの___target___<span class=\"title\">\"___title___\"</span>___type1___<span class=\"action ___type___\">___action___</span>しました。 \\\n          <div class=\"status\">___when___</div> \\\n        </div> \\\n      </a> \\\n      </li>';\n      for(var i=0; i < json.data.length; i++){\n        var data = createMessageParts(json.data[i]);\n        $('#notification-items').append($(html\n          .replace(/___article___/, data.article)\n          .replace(/___image___/, data.image)\n          .replace(/___sender___/, data.sender)\n          .replace(/___target___/, data.target)\n          .replace(/___title___/, data.title)\n          .replace(/___type___/, data.type)\n          .replace(/___type1___/, data.type1)\n          .replace(/___action___/, data.action)\n          .replace(/___when___/, data.when)\n          .replace(/___state___/, data.state)\n        ));\n      }\n    }\n    var favicon = new Favico({\n      animation:'none'\n    });\n    if (json.count != 0) {\n      $('#notification_count').addClass('unchecked').on('click', function(){\n        $.ajax({\n          method: 'POST',\n          url: '/notifications',\n          dataType: 'json',\n          data: {'csrf-token': csrfToken}\n        }).done(function(json){\n          $('#notification_count').removeClass('unchecked').text(json.count);\n          favicon.reset();\n        });\n      });\n      favicon.badge(json.count);\n    } else {\n      favicon.reset();\n    }\n    $(document).on('click', function(){$('.dropdownWrapper').css('display', 'none')});\n    $('#notification_count').on('click', function(e){e.stopPropagation();$('.dropdownWrapper').toggle()});\n  }).fail(function(xhr, status, error){\n    console.log(\"error during get notifications\");\n  });\n\n  function createMessageParts(data){\n    var msg = {};\n    msg.article = data.article_id + (data.fragment_id ? \"#comment-\" + data.fragment_id : \"\");\n    msg.image = data.image;\n    msg.sender = data.sender;\n    msg.title = data.title;\n    msg.type = data.type;\n    if (data.type == \"stock\") {\n      msg.type1 = \"を\";\n      msg.action = \"ストック\";\n    }else if (data.type == \"like\"){\n      msg.type1 = \"に\";\n      msg.action = \"いいね!\";\n    }else{\n      msg.type1 = \"で\";\n      msg.action = \"コメント\";\n    }\n    if (data.is_commenter){\n      msg.target = \"コメントした投稿\";\n    }else{\n      msg.target = \"投稿\";\n    }\n    msg.when = getRelativeTime(data.when);\n    if (data.state) {\n      msg.state = \"\";\n    }else{\n      msg.state = \"unread\";\n    }\n    return msg;\n  }\n\n  // http://qiita.com/rev84/items/2a14a804857de27e9c44\n  function getRelativeTime(targetDateStr){\n    var baseDate = new Date();\n    var targetDate = new Date(targetDateStr);\n    var elapsedTime = Math.ceil((baseDate.getTime() - targetDate.getTime())/1000);\n    var message = null;\n    if (elapsedTime < 60) { //  1 分未満\n      message =  'たった今';\n    } else if (elapsedTime < 120) { //  2 分未満\n      message =  '約 1分前';\n    } else if (elapsedTime < (60*60)) { //  1 時間未満\n      message =  '約' + (Math.floor(elapsedTime / 60) < 10 ? ' ' : '') + Math.floor(elapsedTime / 60) + '分前';\n    } else if (elapsedTime < (120*60)) { //  2 時間未満\n      message =  '約 1時間前';\n    } else if (elapsedTime < (24*60*60)) { //  1 日未満\n      message =  '約' + (Math.floor(elapsedTime / 3600) < 10 ? ' ' : '') + Math.floor(elapsedTime / 3600) + '時間前';\n    } else if (elapsedTime < (7*24*60*60)) { // 1 週間未満\n      message =  '約' + (Math.floor(elapsedTime / 86400) < 10 ? ' ' : '') +Math.floor(elapsedTime / 86400) + '日前';\n    } else { // 1 週間以上\n      message =  '約' + (Math.floor(elapsedTime / 604800) < 10 ? ' ' : '') + Math.floor(elapsedTime / 604800) + '週間前';\n    }\n    return message;\n  }\n};\nmodule.exports = notification;\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/main/webapp/assets/js/notification.js\n// module id = 4\n// module chunks = 1"],"sourceRoot":""}